<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>TXT å·¥åŠåŠ å¯†æ–‡å­—è‡ªåŠ¨è§£å¯†å™¨</title>
<style>
body {
    font-family: "Microsoft YaHei", sans-serif;
    background: #f3f4f6;
    padding: 20px;
}
.container {
    max-width: 900px;
    margin: auto;
    background: white;
    padding: 20px;
    border-radius: 10px;
}
h1 {
    margin-top: 0;
}
textarea {
    width: 100%;
    height: 350px;
    font-family: Consolas, monospace;
    font-size: 15px;
    padding: 10px;
    box-sizing: border-box;
}
button {
    margin-top: 10px;
    padding: 8px 16px;
    font-size: 14px;
    cursor: pointer;
}
.status {
    margin: 10px 0;
    font-weight: bold;
}
</style>
</head>
<body>

<div class="container">
    <h1>ğŸ“„ å·¥åŠ TXT åŠ å¯†æ–‡å­—è‡ªåŠ¨è§£å¯†å™¨</h1>

    <input type="file" id="fileInput" accept=".txt">
    <div class="status" id="status">ç­‰å¾…ä¸Šä¼  TXT æ–‡ä»¶...</div>

    <textarea id="output" placeholder="è§£å¯†åçš„å†…å®¹ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ..." readonly></textarea>

    <button onclick="downloadTxt()">â¬‡ ä¸‹è½½è§£å¯†åçš„ TXT</button>
</div>

<script>
const OFFSET_STD = 0x20000;
const OFFSET_HIGH = 0xE0000;

const fileInput = document.getElementById("fileInput");
const output = document.getElementById("output");
const statusEl = document.getElementById("status");

fileInput.addEventListener("change", () => {
    const file = fileInput.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => {
        const text = reader.result;
        const result = decodeText(text);
        output.value = result.text;
        statusEl.textContent = result.status;
    };
    reader.readAsText(file, "UTF-8");
});

function decodeText(text) {
    let foundStd = false;
    let foundHigh = false;

    const chars = Array.from(text);
    const decoded = chars.map(c => {
        const code = c.codePointAt(0);

        if (code >= OFFSET_HIGH) {
            foundHigh = true;
            return String.fromCodePoint(code - OFFSET_HIGH);
        }
        if (code >= OFFSET_STD) {
            foundStd = true;
            return String.fromCodePoint(code - OFFSET_STD);
        }
        return c;
    }).join("");

    let status = "æœªæ£€æµ‹åˆ°åŠ å¯†æ–‡å­—";
    if (foundHigh && foundStd) status = "æ£€æµ‹åˆ°ã€æ™®é€š + é«˜çº§ã€‘æ··åˆåŠ å¯†ï¼Œå·²è§£å¯†";
    else if (foundHigh) status = "æ£€æµ‹åˆ°ã€é«˜çº§åŠ å¯† (0xE0000)ã€‘ï¼Œå·²è§£å¯†";
    else if (foundStd) status = "æ£€æµ‹åˆ°ã€æ™®é€šåŠ å¯† (0x20000)ã€‘ï¼Œå·²è§£å¯†";

    return { text: decoded, status };
}

function downloadTxt() {
    if (!output.value) return;

    const blob = new Blob([output.value], { type: "text/plain;charset=utf-8" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "decoded.txt";
    a.click();

    URL.revokeObjectURL(url);
}
</script>

</body>
</html>
